var a,b,c,canvas,rect,zoomOnClick=!0,running=!1;function drawOnClick(e){if(rect=canvas.getBoundingClientRect(),zoomOnClick){var t=panX+(e.clientX-rect.left)/zooms,o=panY+(e.clientY-rect.top)/zooms;zooms*=zf,panX=t-(e.clientX-rect.left)/zooms,panY=o-(e.clientY-rect.top)/zooms}else{t=panX+(e.clientX-rect.left)/zooms,o=panY+(e.clientY-rect.top)/zooms;zooms/=zf,panX=t-(e.clientX-rect.left)/zooms,panY=o-(e.clientY-rect.top)/zooms}pan=panX+2/zooms-(panX-1/zooms),document.getElementById("xa").value=panX,document.getElementById("ya").value=panY,document.getElementById("za").value=zooms,pallete.setNumberRange(0,maxI),0<zooms&&zooms<50?(pallete.setNumberRange(0,50),maxI=50):50<zooms&&zooms<100?(pallete.setNumberRange(0,100),maxI=100):100<zooms&&zooms<1e3?(pallete.setNumberRange(0,255),maxI=255):1e3<zooms&&zooms<1e4?(pallete.setNumberRange(0,500),maxI=500):1e4<zooms&&zooms<1e5?(pallete.setNumberRange(0,750),maxI=750):1e5<zooms&&zooms<1e6?(pallete.setNumberRange(0,1e3),maxI=1e3):1e6<zooms&&zooms<1e7&&(pallete.setNumberRange(0,2500),maxI=2500),show(),requestAnimationFrame(abortRun),requestAnimationFrame(startRun)}function plus(){zoomOnClick=!0}function minus(){zoomOnClick=!1}function abortRun(){running&&(running=!1)}function startRun(){setTimeout(function(){running=!0},10),setTimeout(function(){mandelbrot(zooms,panX,panY,8)},10),setTimeout(function(){mandelbrot(zooms,panX,panY,5)},20),setTimeout(function(){mandelbrot(zooms,panX,panY,1)},30)}canvas=document.getElementById("paper"),c=canvas.getContext("2d"),a=canvas.width,b=canvas.height,canvas.onclick=function(e){setTimeout(function(){drawOnClick(e)},10)};try{var pan,zooms,panX,panY,zf,ticks,coloringType,maxI=50,pallete=new Rainbow;pallete.setSpectrum("#000764","#206bcb","#edffff","#ffaa00","#000200"),pallete.setNumberRange(0,maxI);var _pallete=["#000764","#206bcb","#edffff","#ffaa00","#000200"];function mandelbrot(e,t,o,n){if(running){var l,r;for(1===n&&(running=!1),n=n||1,ticks=0,l=0;l<a;l+=n)for(r=0;r<b;r+=n){x0=t+l/e,y0=o+r/e;for(var m,s=0,u=0,p=0;s*s+u*u<=4&&p<maxI;)ticks++,m=s*s-u*u+x0,u=2*s*u+y0,s=m,p+=1;"smoothColoring"===coloringType?p<maxI?(log_zn=Math.log(s*s+u*u)/2,nu=Math.log(log_zn/Math.log(2))/Math.log(2),p=p+1-nu,c.fillStyle=color(p/maxI*(_pallete.length-1)),c.fillRect(l,r,n,n)):(c.fillStyle="black",c.fillRect(l,r,n,n)):(c.fillStyle=color(p),c.fillRect(l,r,n,n))}console.log("Total ticks: "+ticks+", based on scale "+n)}}function color(e,t,o){switch(coloringType){case"escapeTime":return"#"+pallete.colourAt(e);case"smoothColoring":return interpolation(e);default:return"#"+pallete.colourAt(e)}}function hexToRGBObject(e){return e=(e+"").replace("#",""),{r:parseInt(e.charAt(0)+e.charAt(1),16),g:parseInt(e.charAt(2)+e.charAt(3),16),b:parseInt(e.charAt(4)+e.charAt(5),16)}}function linear_interpolate(e,t,o){return"rgb("+Math.floor((t.r-e.r)*o+e.r)+","+Math.floor((t.g-e.g)*o+e.g)+","+Math.floor((t.b-e.b)*o+e.b)+")"}function interpolation(e){return linear_interpolate(hexToRGBObject(_pallete[Math.floor(e)]),hexToRGBObject(_pallete[Math.floor(e)+1]),e%1)}function work(){document.getElementById("xa").value=-2.5,document.getElementById("ya").value=-2,document.getElementById("za").value=a/4,pan=.01,zooms=a/4,panX=-2.5,panY=-2,zf=1.5,maxI=50,pallete.setSpectrum("#000764","#206bcb","#edffff","#ffaa00","#000200"),pallete.setNumberRange(0,maxI),_pallete=["#000764","#206bcb","#edffff","#ffaa00","#000200"],coloringType="smoothColoring",document.getElementById("clrt").value=coloringType,show(),abortRun(),startRun()}function xScroll(e){var t=e?parseFloat(document.getElementById("xa").value)+pan:parseFloat(document.getElementById("xa").value)-pan;document.getElementById("xa").value=t,panX=t,show(),abortRun(),startRun()}function yScroll(e){var t=e?parseFloat(document.getElementById("ya").value)+pan:parseFloat(document.getElementById("ya").value)-pan;document.getElementById("ya").value=t,panY=t,show(),abortRun(),startRun()}function drawAgain(){panX=parseFloat(document.getElementById("xa").value),panY=parseFloat(document.getElementById("ya").value),zooms=parseFloat(document.getElementById("za").value),show(),abortRun(),startRun()}function zoom(){zooms=document.getElementById("za").value,mx=(panX+(a-1)/zooms-panX)/2,panX-=mx,my=(panY+(b-1)/zooms-panY)/2,panY-=mx,show(),abortRun(),startRun()}function zoomIn(){pan=panX+2/(zooms+=zf)-(panX-1/zooms),document.getElementById("za").value=zooms,0<zooms&&zooms<100?(pallete.setNumberRange(0,100),maxI=100):100<zooms&&zooms<1e3?(pallete.setNumberRange(0,255),maxI=255):1e3<zooms&&zooms<1e4&&(pallete.setNumberRange(0,500),maxI=500),show(),abortRun(),startRun()}function zoomOut(){pan=panX+2/(zooms-=zf)-(panX-1/zooms),document.getElementById("za").value=zooms,zooms<100?(pallete.setNumberRange(0,50),maxI=50):zooms>100&&zooms<1e3?(pallete.setNumberRange(0,100),maxI=100):zooms>1e3&&zooms<1e4&&(pallete.setNumberRange(0,255),maxI=255),show(),abortRun(),startRun()}function zoomFactor(){var e=document.getElementById("zf").value;zf=parseInt(e),show()}function changeMaxI(){var e=document.getElementById("mi").value;maxI=parseInt(e),pallete.setNumberRange(0,maxI),show(),abortRun(),startRun()}function changeColoringType(){var e;switch(coloringType){case"smoothColoring":e="escapeTime";break;case"escapeTime":e="smoothColoring"}coloringType=e,document.getElementById("clrt").value=e,show(),abortRun(),startRun()}function changePallete(){var e=document.getElementById("plt").value.split(" ");e.length<3?alert(" Please enter more colors "):(pallete.setSpectrumByArray(e),show(),abortRun(),startRun())}function changeCoords(){var e=document.getElementById("crd").value.split(" ");e.length<4?alert(" Please enter complete details"):(panX=parseFloat(e[0]),panY=parseFloat(e[1]),zooms=parseFloat(e[2]),maxI=parseFloat(e[3]),pallete.setNumberRange(0,maxI),document.getElementById("xa").value=panX,document.getElementById("ya").value=panY,document.getElementById("za").value=zooms,show(),abortRun(),startRun())}function show(){var e="Scroll: "+pan+"<br /> Current zoom: "+zooms+"<br /> topLeftX: "+panX+"<br /> topRightY: "+panY+"<br /> zoom factor: "+zf+"<br /> max iterations of loop: "+maxI+"<br /> uses "+coloringType+" algorithm for coloring";document.getElementById("dtls").innerHTML=e}function about(){alert("A mandelbrot set generator in javascript created by pvzzombs"),console.log("A mandelbrot set generator in javascript created by pvzzombs")}}catch(e){throw"Error: "+e}