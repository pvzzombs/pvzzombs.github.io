var canvasWidth,canvasHeight,canvasContext,rect,oldX,oldY,newX,newY,pinchInitial,pinchCurrent,useInterval=!0,flipImaginaryAxis=1,pixelSizes=[8,5,1],largePixelSize=15,mandelbrotCalls=new Array(pixelSizes.length),drawColumnIDs=new Array(pixelSizes.length),isLoaded=!1,thread=null,canvas=document.getElementById("paper"),canvasWrapper=document.getElementById("canvasWrapper"),isDragging=(canvas.width=canvasWrapper.clientWidth,canvas.height=canvasWrapper.clientWidth,canvasContext=canvas.getContext("2d"),canvasWidth=canvas.width,canvasHeight=canvas.height,!1),adjX=0,adjY=0,tempZooms=zooms,tempPanX=panX,tempPanY=panY;function getDistance(e){var a=e[0].clientX-e[1].clientX,e=e[0].clientY-e[1].clientY;return Math.sqrt(a*a+e*e)}function drawOnTouch(e){document.getElementById("xa").value=panX,document.getElementById("ya").value=panY,document.getElementById("za").value=zooms,pallete.setNumberRange(0,maxI),show(),abortRun(),startRun()}function abortRun(){for(var e=0;e<mandelbrotCalls.length;e++)clearTimeout(mandelbrotCalls[e]);if(useInterval)for(e=0;e<drawColumnIDs.length;e++)clearInterval(drawColumnIDs[e]);else for(e=0;e<drawColumnIDs.length;e++)cancelAnimationFrame(drawColumnIDs[e])}function startRun(){for(var e=0;e<pixelSizes.length;e++)mandelbrotCalls[e]=setTimeout(function(e){return function(){mandelbrot(zooms,panX,panY,pixelSizes[e],e)}}(e))}canvas.onmousedown=function(e){e.preventDefault(),isLoaded&&(rect=canvas.getBoundingClientRect(),isDragging=!0,oldX=e.clientX-rect.left,oldY=e.clientY-rect.top,tempZooms=zooms,tempPanX=panX,tempPanY=panY,abortRun())},canvas.onmousemove=function(e){e.preventDefault(),isLoaded&&isDragging&&(rect=canvas.getBoundingClientRect(),newX=e.clientX-rect.left,newY=e.clientY-rect.top,mandelbrotLargePixel(tempZooms,tempPanX-(adjX=panX+newX/zooms-(panX+oldX/zooms)),tempPanY-(adjY=panY+flipImaginaryAxis*(newY/zooms)-(panY+flipImaginaryAxis*(oldY/zooms)))))},canvas.onmouseup=function(e){e.preventDefault(),isLoaded&&(isDragging=!1,panX=tempPanX,panY=tempPanY,panY-=adjY,pan=(panX-=adjX)+2/(zooms=tempZooms)-(panX-1/zooms),adjY=adjX=0,drawOnTouch(e))},canvas.onmouseleave=function(e){e.preventDefault(),isLoaded&&isDragging&&(isDragging=!1,panX=tempPanX,panY=tempPanY,panY-=adjY,pan=(panX-=adjX)+2/(zooms=tempZooms)-(panX-1/zooms),adjY=adjX=0,drawOnTouch(e))},canvas.onwheel=function(e){var a,n,t;abortRun(),e.preventDefault(),isLoaded&&(a=e.deltaY,n=panX+canvasWidth/2/zooms,t=panY+flipImaginaryAxis*(canvasHeight/2/zooms),0<a?zooms/=1.1:a<0&&(zooms*=1.1),mandelbrotLargePixel(zooms,panX=n-canvasWidth/2/zooms,panY=t-flipImaginaryAxis*(canvasHeight/2/zooms)),drawOnTouch(e))},canvas.ontouchstart=function(e){var a;e.preventDefault(),isLoaded&&(rect=canvas.getBoundingClientRect(),1===e.touches.length?(isDragging=!0,a=e.touches[0],oldX=a.clientX-rect.left,oldY=a.clientY-rect.top):2===e.touches.length&&(pinchInitial=getDistance(e.touches)),tempZooms=zooms,tempPanX=panX,tempPanY=panY,abortRun())},canvas.ontouchmove=function(e){if(e.preventDefault(),isLoaded){if(rect=canvas.getBoundingClientRect(),2===e.touches.length){var a=getDistance(e.touches),n=tempPanY+flipImaginaryAxis*(canvasHeight/2/tempZooms);tempPanX=tempPanX+canvasWidth/2/tempZooms-canvasWidth/2/(tempZooms*=a/pinchInitial),tempPanY=n-flipImaginaryAxis*(canvasHeight/2/tempZooms)}else if(1===e.touches.length){if(!isDragging)return;a=e.touches[0],n=(newX=a.clientX-rect.left,newY=a.clientY-rect.top,panX+oldX/zooms);adjX=panX+newX/zooms-n,adjY=panY+flipImaginaryAxis*(newY/zooms)-(panY+flipImaginaryAxis*(oldY/zooms))}mandelbrotLargePixel(tempZooms,tempPanX-adjX,tempPanY-adjY)}},canvas.ontouchend=function(e){e.preventDefault(),isLoaded&&(isDragging=!1,panX=tempPanX,panY=tempPanY,panY-=adjY,pan=(panX-=adjX)+2/(zooms=tempZooms)-(panX-1/zooms),adjY=adjX=0,drawOnTouch(e))};var pan,zooms,panX,panY,zf,ticks,coloringType,maxI=50,pallete=new Rainbow,_pallete=(pallete.setSpectrum("#000764","#206bcb","#edffff","#ffaa00","#000200"),pallete.setNumberRange(0,maxI),["#000764","#206bcb","#edffff","#ffaa00","#000200"]);function mdbl(e,a,n,t,o,l,i,r,s){for(a=0;a<canvasHeight;a+=r){x0=l+e/o,y0=i+flipImaginaryAxis*(a/o);for(var m,n=0,t=0,c=0;n*n+t*t<=4&&c<maxI;)m=n*n-t*t+x0,t=2*n*t+y0,n=m,c+=1;s(e,a,n,t,c,r)}}function mandelbrot(a,n,t,o,l){var i,r,s,m;o=o||1,i=0,drawColumnIDs[l]=useInterval?setInterval(function(){i<canvasWidth?(mdbl(i,r,s,m,a,n,t,o,coloringMethod),i+=o):clearInterval(drawColumnIDs[l])}):requestAnimationFrame(function e(){i<canvasWidth?(mdbl(i,r,s,m,a,n,t,o,coloringMethod),i+=o,drawColumnIDs[l]=requestAnimationFrame(e)):cancelAnimationFrame(drawColumnIDs[l])})}function mandelbrotLargePixel(e,a,n){for(var t=0;t<canvasWidth;)mdbl(t,void 0,void 0,void 0,e,a,n,largePixelSize,coloringMethod),t+=largePixelSize}function coloringMethod(e,a,n,t,o,l){"smoothColoring"===coloringType?o<maxI?(log_zn=Math.log(n*n+t*t)/2,o=o+1-(nu=Math.log(log_zn/Math.log(2))/Math.log(2)),canvasContext.fillStyle=color(o/maxI*(_pallete.length-1))):canvasContext.fillStyle="black":canvasContext.fillStyle=color(o),canvasContext.fillRect(e,a,l,l)}function color(e){switch(coloringType){case"escapeTime":return"#"+pallete.colourAt(e);case"smoothColoring":return interpolation(e);default:return"#"+pallete.colourAt(e)}}function hexToRGBObject(e){return e=(e+"").replace("#",""),{r:parseInt(e.charAt(0)+e.charAt(1),16),g:parseInt(e.charAt(2)+e.charAt(3),16),b:parseInt(e.charAt(4)+e.charAt(5),16)}}function linear_interpolate(e,a,n){return"rgb("+Math.floor((a.r-e.r)*n+e.r)+","+Math.floor((a.g-e.g)*n+e.g)+","+Math.floor((a.b-e.b)*n+e.b)+")"}function interpolation(e){return linear_interpolate(hexToRGBObject(_pallete[Math.floor(e)]),hexToRGBObject(_pallete[Math.floor(e)+1]),e%1)}function work(){isLoaded&&(pan=.1,zooms=canvasWidth/4,panX=-2.5,panY=-2*(flipImaginaryAxis=1),zf=1.5,maxI=50,pallete.setSpectrum("#000764","#206bcb","#edffff","#ffaa00","#000200"),pallete.setNumberRange(0,maxI),_pallete=["#000764","#206bcb","#edffff","#ffaa00","#000200"],coloringType="smoothColoring",document.getElementById(coloringType).checked=!0,document.getElementById("flipImaginaryAxis").checked=!0,document.getElementById("xa").value=panX,document.getElementById("ya").value=panY,document.getElementById("za").value=zooms,show(),abortRun(),mandelbrotLargePixel(zooms,panX,panY),startRun())}function resetCoordinates(){isLoaded&&(pan=.1,zooms=canvasWidth/4,panX=-2.5,panY=-2*flipImaginaryAxis,document.getElementById("xa").value=panX,document.getElementById("ya").value=panY,document.getElementById("za").value=zooms,show(),abortRun(),startRun())}function flipImagAxis(){isLoaded&&(flipImaginaryAxis=1==flipImaginaryAxis?-1:1,panY*=-1,document.getElementById("ya").value=panY,show(),abortRun(),mandelbrotLargePixel(zooms,panX,panY),startRun())}function xScroll(e){isLoaded&&(e=e?parseFloat(document.getElementById("xa").value)+pan:parseFloat(document.getElementById("xa").value)-pan,document.getElementById("xa").value=e,panX=e,show(),abortRun(),startRun())}function yScroll(e){isLoaded&&(e=e?parseFloat(document.getElementById("ya").value)+pan:parseFloat(document.getElementById("ya").value)-pan,document.getElementById("ya").value=e,panY=e,show(),abortRun(),startRun())}function drawAgain(){isLoaded&&(panX=parseFloat(document.getElementById("xa").value),panY=parseFloat(document.getElementById("ya").value),zooms=parseFloat(document.getElementById("za").value),show(),abortRun(),startRun())}function zoom(){isLoaded&&(zooms=document.getElementById("za").value,mx=(panX+(canvasWidth-1)/zooms-panX)/2,panX-=mx,my=(panY+(canvasHeight-1)/zooms-panY)/2,panY-=mx,show(),abortRun(),startRun())}function zoomIn(){isLoaded&&(pan=panX+2/(zooms+=zf)-(panX-1/zooms),document.getElementById("za").value=zooms,show(),abortRun(),startRun())}function zoomOut(){isLoaded&&(pan=panX+2/(zooms-=zf)-(panX-1/zooms),document.getElementById("za").value=zooms,show(),abortRun(),startRun())}function zoomFactor(){var e;isLoaded&&(e=document.getElementById("zf").value,zf=parseFloat(e),show())}function changeMaxI(){var e;isLoaded&&(e=document.getElementById("mi").value,maxI=parseInt(e),pallete.setNumberRange(0,maxI),show(),abortRun(),startRun())}function changeColoringType(e){isLoaded&&(e=e.value,coloringType=e,show(),abortRun(),startRun())}function changePallete(){var e;isLoaded&&((e=document.getElementById("plt").value.split(" ")).length<3?alert(" Please enter more colors "):(pallete.setSpectrumByArray(e),show(),abortRun(),startRun()))}function changeCoords(){var e;isLoaded&&((e=document.getElementById("crd").value.split(" ")).length<4?alert(" Please enter complete details"):(panX=parseFloat(e[0]),panY=parseFloat(e[1]),zooms=parseFloat(e[2]),maxI=parseFloat(e[3]),zf=1.5,pan=panX+2/zooms-(panX-1/zooms),pallete.setNumberRange(0,maxI),document.getElementById("xa").value=panX,document.getElementById("ya").value=panY,document.getElementById("za").value=zooms,document.getElementById("mi").value=maxI,document.getElementById("zf").value=zf,show(),abortRun(),startRun()))}function fullResize(){}function resize(){canvasWidth=canvas.width=parseInt(prompt("Please enter canvas width in pixels",200))||200,canvasHeight=canvas.height=parseInt(prompt("Please enter canvas height in pixels",200))||200,work()}function iterationsTimesTwo(){isLoaded&&(maxI*=2,show(),abortRun(),startRun())}function iterationsDividedByTwo(){isLoaded&&(maxI/=2,show(),abortRun(),startRun())}function changeBigPixelSize(){isLoaded&&Swal.fire({title:"Info",input:"text",text:"Change big pixel size",inputValue:20,inputPlaceholder:"20"}).then(function(e){e=parseInt(e.value);Number.isNaN(e)?Swal.fire({icon:"error",title:"Error",text:"Invalid number!"}):largePixelSize=e})}function show(){var e="Scroll: "+pan+"<br /> Current zoom: "+zooms+"<br /> left: "+panX+"<br /> right: "+(panX+canvasWidth/zooms)+"<br /> top: "+panY+"<br /> bottom: "+(panY+flipImaginaryAxis*(canvasHeight/zooms))+"<br /> zoom factor: "+zf+"<br /> max iterations of loop: "+maxI+"<br /> uses "+coloringType+" algorithm for coloring";document.getElementById("dtls").innerHTML=e}function about(){Swal.fire({icon:"info",title:"About",text:"A mandelbrot set generator in javascript created by pvzzombs. "})}function startMandelbrot(){(thread=new Worker("getOptimalPixel.js")).onmessage=function(e){console.log("Time is ",e.data.ms),console.log("Pixel is ",e.data.pixelSize),isLoaded=!0,largePixelSize=e.data.pixelSize,work(),document.getElementById("loadingText").innerText=""}}startMandelbrot();