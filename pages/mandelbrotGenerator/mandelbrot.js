var canvasWidth,canvasHeight,canvasContext,rect,oldX,oldY,newX,newY,pinchInitial,pinchCurrent,zoomOnClick=!0,useInterval=!0,flipImaginaryAxis=1,pixelSizes=[8,5,1],mandelbrotCalls=new Array(pixelSizes.length),drawColumnIDs=new Array(pixelSizes.length),canvas=document.getElementById("paper"),canvasWrapper=document.getElementById("canvasWrapper"),isDragging=(canvas.width=canvasWrapper.clientWidth,canvas.height=canvasWrapper.clientWidth,canvasContext=canvas.getContext("2d"),canvasWidth=canvas.width,canvasHeight=canvas.height,!1),adjX=0,adjY=0,tempZooms=zooms,tempPanX=panX,tempPanY=panY;function getDistance(a){var e=a[0].clientX-a[1].clientX,a=a[0].clientY-a[1].clientY;return Math.sqrt(e*e+a*a)}function drawOnTouch(a){document.getElementById("xa").value=panX,document.getElementById("ya").value=panY,document.getElementById("za").value=zooms,pallete.setNumberRange(0,maxI),show(),abortRun(),startRun()}function drawOnClick(a){rect=canvas.getBoundingClientRect();var e,n,t=a.clientX-rect.left,o=a.clientY-rect.top;panY=(panX=(zoomOnClick?(e=panX+t/zooms,n=panY+flipImaginaryAxis*(o/zooms),zooms*=zf):(e=panX+t/zooms,n=panY+flipImaginaryAxis*(o/zooms),zooms/=zf),e-(a.clientX-rect.left)/zooms),n-flipImaginaryAxis*((a.clientY-rect.top)/zooms)),pan=panX+2/zooms-(panX-1/zooms),document.getElementById("xa").value=panX,document.getElementById("ya").value=panY,document.getElementById("za").value=zooms,pallete.setNumberRange(0,maxI),show(),abortRun(),startRun()}function plus(){zoomOnClick=!0}function minus(){zoomOnClick=!1}function abortRun(){for(var a=0;a<mandelbrotCalls.length;a++)clearTimeout(mandelbrotCalls[a]);if(useInterval)for(a=0;a<drawColumnIDs.length;a++)clearInterval(drawColumnIDs[a]);else for(a=0;a<drawColumnIDs.length;a++)cancelAnimationFrame(drawColumnIDs[a])}function startRun(){for(var a=0;a<pixelSizes.length;a++)mandelbrotCalls[a]=setTimeout(function(a){return function(){mandelbrot(zooms,panX,panY,pixelSizes[a],a)}}(a))}canvas.onmousedown=function(a){a.preventDefault(),rect=canvas.getBoundingClientRect(),isDragging=!0,oldX=a.clientX-rect.left,oldY=a.clientY-rect.top,tempZooms=zooms,tempPanX=panX,tempPanY=panY,abortRun()},canvas.onmousemove=function(a){a.preventDefault(),isDragging&&(rect=canvas.getBoundingClientRect(),newX=a.clientX-rect.left,newY=a.clientY-rect.top,mandelbrotLargePixel(tempZooms,tempPanX-(adjX=panX+newX/zooms-(panX+oldX/zooms)),tempPanY-(adjY=panY+flipImaginaryAxis*(newY/zooms)-(panY+flipImaginaryAxis*(oldY/zooms)))))},canvas.onmouseup=function(a){a.preventDefault(),isDragging=!1,panX=tempPanX,panY=tempPanY,panY-=adjY,pan=(panX-=adjX)+2/(zooms=tempZooms)-(panX-1/zooms),adjY=adjX=0,drawOnTouch(a)},canvas.onmouseleave=function(a){a.preventDefault(),isDragging&&(isDragging=!1,panX=tempPanX,panY=tempPanY,panY-=adjY,pan=(panX-=adjX)+2/(zooms=tempZooms)-(panX-1/zooms),adjY=adjX=0,drawOnTouch(a))},canvas.onwheel=function(a){abortRun(),a.preventDefault();var e=a.deltaY,n=panX+canvasWidth/2/zooms,t=panY+flipImaginaryAxis*(canvasHeight/2/zooms);0<e?zooms/=1.1:e<0&&(zooms*=1.1),mandelbrotLargePixel(zooms,panX=n-canvasWidth/2/zooms,panY=t-flipImaginaryAxis*(canvasHeight/2/zooms)),drawOnTouch(a)},canvas.ontouchstart=function(a){var e;a.preventDefault(),rect=canvas.getBoundingClientRect(),1===a.touches.length?(isDragging=!0,e=a.touches[0],oldX=e.clientX-rect.left,oldY=e.clientY-rect.top):2===a.touches.length&&(pinchInitial=getDistance(a.touches)),tempZooms=zooms,tempPanX=panX,tempPanY=panY,abortRun()},canvas.ontouchmove=function(a){if(a.preventDefault(),rect=canvas.getBoundingClientRect(),2===a.touches.length){var e=getDistance(a.touches),n=tempPanY+flipImaginaryAxis*(canvasHeight/2/tempZooms);tempPanX=tempPanX+canvasWidth/2/tempZooms-canvasWidth/2/(tempZooms*=e/pinchInitial),tempPanY=n-flipImaginaryAxis*(canvasHeight/2/tempZooms)}else if(1===a.touches.length){if(!isDragging)return;e=a.touches[0],n=(newX=e.clientX-rect.left,newY=e.clientY-rect.top,panX+oldX/zooms);adjX=panX+newX/zooms-n,adjY=panY+flipImaginaryAxis*(newY/zooms)-(panY+flipImaginaryAxis*(oldY/zooms))}mandelbrotLargePixel(tempZooms,tempPanX-adjX,tempPanY-adjY)},canvas.ontouchend=function(a){a.preventDefault(),isDragging=!1,panX=tempPanX,panY=tempPanY,panY-=adjY,pan=(panX-=adjX)+2/(zooms=tempZooms)-(panX-1/zooms),adjY=adjX=0,drawOnTouch(a)};var pan,zooms,panX,panY,zf,ticks,coloringType,maxI=50,pallete=new Rainbow,_pallete=(pallete.setSpectrum("#000764","#206bcb","#edffff","#ffaa00","#000200"),pallete.setNumberRange(0,maxI),["#000764","#206bcb","#edffff","#ffaa00","#000200"]);function mdbl(a,e,n,t,o,l,r,i,m){for(e=0;e<canvasHeight;e+=i){x0=l+a/o,y0=r+flipImaginaryAxis*(e/o);for(var s,n=0,t=0,c=0;n*n+t*t<=4&&c<maxI;)s=n*n-t*t+x0,t=2*n*t+y0,n=s,c+=1;m(a,e,n,t,c,i)}}function mandelbrot(e,n,t,o,l){var r;o=o||1,r=0,drawColumnIDs[l]=useInterval?setInterval(function(){r<canvasWidth?(mdbl(r,void 0,void 0,void 0,e,n,t,o,coloringMethod),r+=o):clearInterval(drawColumnIDs[l])}):requestAnimationFrame(function a(){r<canvasWidth?(mdbl(r,void 0,void 0,void 0,e,n,t,o,coloringMethod),r+=o,drawColumnIDs[l]=requestAnimationFrame(a)):cancelAnimationFrame(drawColumnIDs[l])})}function mandelbrotLargePixel(a,e,n){for(var t=0;t<canvasWidth;)mdbl(t,void 0,void 0,void 0,a,e,n,20,coloringMethod),t+=20}function coloringMethod(a,e,n,t,o,l){"smoothColoring"===coloringType?o<maxI?(log_zn=Math.log(n*n+t*t)/2,o=o+1-(nu=Math.log(log_zn/Math.log(2))/Math.log(2)),canvasContext.fillStyle=color(o/maxI*(_pallete.length-1))):canvasContext.fillStyle="black":canvasContext.fillStyle=color(o),canvasContext.fillRect(a,e,l,l)}function color(a){switch(coloringType){case"escapeTime":return"#"+pallete.colourAt(a);case"smoothColoring":return interpolation(a);default:return"#"+pallete.colourAt(a)}}function hexToRGBObject(a){return a=(a+"").replace("#",""),{r:parseInt(a.charAt(0)+a.charAt(1),16),g:parseInt(a.charAt(2)+a.charAt(3),16),b:parseInt(a.charAt(4)+a.charAt(5),16)}}function linear_interpolate(a,e,n){return"rgb("+Math.floor((e.r-a.r)*n+a.r)+","+Math.floor((e.g-a.g)*n+a.g)+","+Math.floor((e.b-a.b)*n+a.b)+")"}function interpolation(a){return linear_interpolate(hexToRGBObject(_pallete[Math.floor(a)]),hexToRGBObject(_pallete[Math.floor(a)+1]),a%1)}function work(){pan=.1,zooms=canvasWidth/4,panX=-2.5,panY=-2*(flipImaginaryAxis=1),zf=1.5,maxI=50,pallete.setSpectrum("#000764","#206bcb","#edffff","#ffaa00","#000200"),pallete.setNumberRange(0,maxI),_pallete=["#000764","#206bcb","#edffff","#ffaa00","#000200"],coloringType="smoothColoring",document.getElementById(coloringType).checked=!0,document.getElementById("flipImaginaryAxis").checked=!0,document.getElementById("xa").value=panX,document.getElementById("ya").value=panY,document.getElementById("za").value=zooms,show(),abortRun(),mandelbrotLargePixel(zooms,panX,panY),startRun()}function resetCoordinates(){pan=.1,zooms=canvasWidth/4,panX=-2.5,panY=-2*flipImaginaryAxis,document.getElementById("xa").value=panX,document.getElementById("ya").value=panY,document.getElementById("za").value=zooms,show(),abortRun(),startRun()}function flipImagAxis(){flipImaginaryAxis=1==flipImaginaryAxis?-1:1,panY*=-1,document.getElementById("ya").value=panY,show(),abortRun(),startRun()}function xScroll(a){a=a?parseFloat(document.getElementById("xa").value)+pan:parseFloat(document.getElementById("xa").value)-pan;document.getElementById("xa").value=a,panX=a,show(),abortRun(),startRun()}function yScroll(a){a=a?parseFloat(document.getElementById("ya").value)+pan:parseFloat(document.getElementById("ya").value)-pan;document.getElementById("ya").value=a,panY=a,show(),abortRun(),startRun()}function drawAgain(){panX=parseFloat(document.getElementById("xa").value),panY=parseFloat(document.getElementById("ya").value),zooms=parseFloat(document.getElementById("za").value),show(),abortRun(),startRun()}function zoom(){zooms=document.getElementById("za").value,mx=(panX+(canvasWidth-1)/zooms-panX)/2,panX-=mx,my=(panY+(canvasHeight-1)/zooms-panY)/2,panY-=mx,show(),abortRun(),startRun()}function zoomIn(){pan=panX+2/(zooms+=zf)-(panX-1/zooms),document.getElementById("za").value=zooms,show(),abortRun(),startRun()}function zoomOut(){pan=panX+2/(zooms-=zf)-(panX-1/zooms),document.getElementById("za").value=zooms,show(),abortRun(),startRun()}function zoomFactor(){var a=document.getElementById("zf").value;zf=parseFloat(a),show()}function changeMaxI(){var a=document.getElementById("mi").value;maxI=parseInt(a),pallete.setNumberRange(0,maxI),show(),abortRun(),startRun()}function changeColoringType(a){a=a.value;coloringType=a,show(),abortRun(),startRun()}function changePallete(){var a=document.getElementById("plt").value.split(" ");a.length<3?alert(" Please enter more colors "):(pallete.setSpectrumByArray(a),show(),abortRun(),startRun())}function changeCoords(){var a=document.getElementById("crd").value.split(" ");a.length<4?alert(" Please enter complete details"):(panX=parseFloat(a[0]),panY=parseFloat(a[1]),zooms=parseFloat(a[2]),maxI=parseFloat(a[3]),zf=1.5,pan=panX+2/zooms-(panX-1/zooms),pallete.setNumberRange(0,maxI),document.getElementById("xa").value=panX,document.getElementById("ya").value=panY,document.getElementById("za").value=zooms,document.getElementById("mi").value=maxI,document.getElementById("zf").value=zf,show(),abortRun(),startRun())}function fullResize(){}function resize(){canvasWidth=canvas.width=parseInt(prompt("Please enter canvas width in pixels",200))||200,canvasHeight=canvas.height=parseInt(prompt("Please enter canvas height in pixels",200))||200,work()}function show(){var a="Scroll: "+pan+"<br /> Current zoom: "+zooms+"<br /> left: "+panX+"<br /> right: "+(panX+canvasWidth/zooms)+"<br /> top: "+panY+"<br /> bottom: "+(panY+flipImaginaryAxis*(canvasHeight/zooms))+"<br /> zoom factor: "+zf+"<br /> max iterations of loop: "+maxI+"<br /> uses "+coloringType+" algorithm for coloring";document.getElementById("dtls").innerHTML=a}function about(){Swal.fire({icon:"info",title:"About",text:"A mandelbrot set generator in javascript created by pvzzombs. "})}work();