!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.SuperGif=t()}(this,function(){function W(e){this.data=e,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[this.pos++]:255&e.charCodeAt(this.pos++)},this.readBytes=function(e){for(var t=[],n=0;n<e;n++)t.push(this.readByte());return t},this.read=function(e){for(var t="",n=0;n<e;n++)t+=String.fromCharCode(this.readByte());return t},this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}}function X(i,o){o=o||{};var n=function(e){for(var t=[],n=0;n<e;n++)t.push(i.readBytes(3));return t},u=function(){for(var e,t="";e=i.readByte(),t+=i.read(e),0!==e;);return t},t=function(e){function t(e){var t;i.readByte(),"NETSCAPE"===(e.identifier=i.read(8),e.authCode=i.read(3),e.identifier)?(t=e,i.readByte(),t.unknown=i.readByte(),t.iterations=i.readUnsigned(),t.terminator=i.readByte(),o.app&&o.app.NETSCAPE&&o.app.NETSCAPE(t)):((t=e).appData=u(),o.app&&o.app[t.identifier]&&o.app[t.identifier](t))}var n,r,a;switch(e.label=i.readByte(),e.label){case 249:e.extType="gce",r=e,i.readByte(),a=f(i.readByte()),r.reserved=a.splice(0,3),r.disposalMethod=s(a.splice(0,3)),r.userInput=a.shift(),r.transparencyGiven=a.shift(),r.delayTime=i.readUnsigned(),r.transparencyIndex=i.readByte(),r.terminator=i.readByte(),o.gce&&o.gce(r);break;case 254:e.extType="com",(a=e).comment=u(),o.com&&o.com(a);break;case 1:e.extType="pte",r=e,i.readByte(),r.ptHeader=i.readBytes(12),r.ptData=u(),o.pte&&o.pte(r);break;case 255:e.extType="app",t(e);break;default:e.extType="unknown",(n=e).data=u(),o.unknown&&o.unknown(n)}},r=function(e){e.leftPos=i.readUnsigned(),e.topPos=i.readUnsigned(),e.width=i.readUnsigned(),e.height=i.readUnsigned();var t=f(i.readByte()),t=(e.lctFlag=t.shift(),e.interlaced=t.shift(),e.sorted=t.shift(),e.reserved=t.splice(0,2),e.lctSize=s(t.splice(0,3)),e.lctFlag&&(e.lct=n(1<<e.lctSize+1)),e.lzwMinCodeSize=i.readByte(),u());e.pixels=c(e.lzwMinCodeSize,t),e.interlaced&&(e.pixels=function(e,t){for(var n=new Array(e.length),r=e.length/t,a=[0,4,2,1],i=[8,8,4,2],o=0,u=0;u<4;u++)for(var l=a[u];l<r;l+=i[u]){{var s=l;var f=o;f=e.slice(f*t,(f+1)*t);n.splice.apply(n,[s*t,t].concat(f))}o++}return n}(e.pixels,e.width)),o.img&&o.img(e)},a=function(){var e={};switch(e.sentinel=i.readByte(),String.fromCharCode(e.sentinel)){case"!":e.type="ext",t(e);break;case",":e.type="img",r(e);break;case";":e.type="eof",o.eof&&o.eof(e);break;default:throw new Error("Unknown block: 0x"+e.sentinel.toString(16))}"eof"!==e.type&&setTimeout(a,0)},e={};if(e.sig=i.read(3),e.ver=i.read(3),"GIF"!==e.sig)throw new Error("Not a GIF file.");e.width=i.readUnsigned(),e.height=i.readUnsigned();var l=f(i.readByte());e.gctFlag=l.shift(),e.colorRes=s(l.splice(0,3)),e.sorted=l.shift(),e.gctSize=s(l.splice(0,3)),e.bgColor=i.readByte(),e.pixelAspectRatio=i.readByte(),e.gctFlag&&(e.gct=n(1<<e.gctSize+1)),o.hdr&&o.hdr(e),setTimeout(a,0)}var s=function(e){return e.reduce(function(e,t){return 2*e+t},0)},f=function(e){for(var t=[],n=7;0<=n;n--)t.push(!!(e&1<<n));return t},c=function(e,r){for(var t,n,a=0,i=[],o=1<<e,u=1+o,l=e+1,s=[];;)if(n=t,(t=function(e){for(var t=0,n=0;n<e;n++)r.charCodeAt(a>>3)&1<<(7&a)&&(t|=1<<n),a++;return t}(l))!==o){if(t===u)break;if(t<s.length)n!==o&&s.push(s[n].concat(s[t][0]));else{if(t!==s.length)throw new Error("Invalid LZW code.");s.push(s[n].concat(s[n][0]))}i.push.apply(i,s[t]),s.length===1<<l&&l<12&&l++}else{f=void 0;s=[],l=e+1;for(var f=0;f<o;f++)s[f]=[f];s[o]=[],s[u]=null}return i};return function(e){var t,n={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null,auto_play:!0};for(t in e)n[t]=e[t];n.vp_w&&n.vp_h&&(n.is_vp=!0);var r,a,i=null,o=!1,u=null,l=null,s=null,f=null,c=null,d=null,p=null,g=!0,D=!0,h=[],y=[],m=document.createElement("img");m.src=n.gif;function v(){c=s,d=s=l=u=null}function _(){try{X(r,q)}catch(e){w("parse")}}function w(e){i=e,h=[]}function x(){d&&(h.push({data:d.getImageData(0,0,a.width,a.height),delay:l}),y.push({x:0,y:0}))}function B(){}function T(t,e){return function(e){t(e)}}function b(){C=n.p5inst.createImage(1,1),P=C.canvas,z=!0}function M(e){return!o&&(F=e||!1,o=!0,h=[],v(),!(p=d=c=f=null))}var P,C,S,k,E,I,R,N,O,U,A,H=n.hasOwnProperty("on_end")?n.on_end:null,L=n.hasOwnProperty("loop_delay")?n.loop_delay:0,j=n.hasOwnProperty("loop_mode")?n.loop_mode:"auto",G=(E=-1,I=0,R=function(){return(E+(D?1:-1)+h.length)%h.length},S=!(O=function(){null!==H&&H(m),I++}),{init:function(){i||(n.auto_play?U:(E=0,A))()},step:U=function(){S||setTimeout(k,0)},play:function(){g=!0,U()},pause:function(){g=!1},playing:g,move_relative:N=function(e){E+=e,A()},current_frame:function(){return E},length:function(){return h.length},move_to:function(e){E=e,A()},get_frames:function(){return h},buffer:function(){return C},get_playing:function(){return g}}),q={hdr:T(function(e){var t;e=(a=e).width,t=a.height,C.resize(e,t),C.width=e,C.height=t}),gce:T(function(e){x(),v(),u=e.transparencyGiven?e.transparencyIndex:null,l=e.delayTime,s=e.disposalMethod}),com:T(B),app:{NETSCAPE:T(B)},img:T(function(e){d=d||P.getContext("2d");var t=h.length,n=e.lctFlag?e.lct:a.gct,t=(0<t&&(3===c?null!==f?d.putImageData(h[f].data,0,0):d.clearRect(p.leftPos,p.topPos,p.width,p.height):f=t-1,2===c)&&d.clearRect(p.leftPos,p.topPos,p.width,p.height),d.getImageData(e.leftPos,e.topPos,e.width,e.height)),r=t.data;e.pixels.forEach(function(e,t){e!==u&&(r[4*t+0]=n[e][0],r[4*t+1]=n[e][1],r[4*t+2]=n[e][2],r[4*t+3]=255)}),t.data.set(r),d.putImageData(t,e.leftPos,e.topPos),p=e}),eof:function(e){x(),G.init(),o=!1,console.log("ok"),F&&F(m)}},z=!(A=function(){var e;(E=parseInt(E,10))>h.length-1&&(E=0),e=y[E=E<0?0:E],P.getContext("2d").putImageData(h[E].data,e.x,e.y)}),F=!(k=function(){var e,t;(S=g)&&(N(1),e=(e=10*h[E].delay)||100,0===(t=R())&&(e+=L,setTimeout(O,e-1)),!1!==j||0!==t||I<0)&&setTimeout(k,e)});return{play:G.play,pause:G.pause,move_relative:G.move_relative,move_to:G.move_to,get_playing:G.get_playing,get_canvas:function(){return canvas},get_canvas_scale:function(){return n.max_width&&a&&a.width>n.max_width?n.max_width/a.width:1},get_loading:function(){return o},get_auto_play:function(){return n.auto_play},get_length:function(){return G.length()},get_current_frame:function(){return G.current_frame()},get_frames:function(){return G.get_frames()},buffer:function(){return G.buffer()},load_url:function(e,t){var n;M(t)&&((n=new XMLHttpRequest).overrideMimeType("text/plain; charset=x-user-defined"),n.onloadstart=function(){z||b()},n.onload=function(e){r=new W(n.responseText),setTimeout(_,0)},n.onerror=function(){w("xhr")},n.open("GET",e,!0),n.send())},load:function(e){this.load_url(m.src,e)},load_raw:function(e,t){M(t)&&(z||b(),r=new W(e),setTimeout(_,0))},set_frame_offset:function(e,t){return y[e]?(void 0!==t.x&&(y[e].x=t.x),void(void 0!==t.y&&(y[e].y=t.y))):void(y[e]=t)}}}}),p5.prototype.loadGif=function(e,t){var n=new SuperGif({gif:e,p5inst:this}),e=(n.load(t),n.buffer());return e.play=n.play,e.pause=n.pause,e.playing=n.get_playing,e.frames=n.get_frames,e.totalFrames=n.get_length,e.loaded=function(){return!n.get_loading()},e.frame=function(e){return"number"!=typeof e?n.get_current_frame():void n.move_to(e)},e},p5.prototype.loadRawGif=function(e,t){var n=new SuperGif({gif:"",p5inst:this}),e=(n.load_raw(e,t),n.buffer());return e.play=n.play,e.pause=n.pause,e.playing=n.get_playing,e.frames=n.get_frames,e.totalFrames=n.get_length,e.loaded=function(){return!n.get_loading()},e.frame=function(e){return"number"!=typeof e?n.get_current_frame():void n.move_to(e)},e};